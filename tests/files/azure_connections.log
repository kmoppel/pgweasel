2025-05-21 11:00:00 UTC-682db013.35b-LOG:  [pg-availability]: current_lsn: 0/8023A90, current_lsn_counter: 6, spi_return_msg: SPI_OK_UPDATE
2025-05-21 11:00:05 UTC-682db221.4e8-LOG:  disconnection: session time: 0:00:20.053 user=azuresu database=azure_sys host=127.0.0.1 port=37940
2025-05-21 11:00:09 UTC-682db225.4eb-LOG:  disconnection: session time: 0:00:20.039 user=azuresu database=azure_maintenance host=127.0.0.1 port=54794
2025-05-21 11:00:10 UTC-682db226.4ec-LOG:  disconnection: session time: 0:00:20.031 user=azuresu database=postgres host=127.0.0.1 port=54806
2025-05-21 11:00:10 UTC-682db23a.501-LOG:  connection received: host=127.0.0.1 port=34834
2025-05-21 11:00:10 UTC-682db23a.501-LOG:  connection authenticated: identity=\"CN=azuresu.d481e194acdf.database.azure.com\" method=cert (/datadrive/pg/data/pg_hba.conf:12)
2025-05-21 11:00:10 UTC-682db23a.501-LOG:  connection authorized: user=azuresu database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)
2025-05-21 11:00:13 UTC-682db23d.504-LOG:  connection received: host=127.0.0.1 port=34850
2025-05-21 11:00:13 UTC-682db23d.504-LOG:  connection authenticated: identity=\"CN=azuresu.d481e194acdf.database.azure.com\" method=cert (/datadrive/pg/data/pg_hba.conf:12)
2025-05-21 11:00:13 UTC-682db23d.504-LOG:  connection authorized: user=azuresu database=azure_maintenance SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)
2025-05-21 11:00:16 UTC-682db240.505-LOG:  connection received: host=127.0.0.1 port=34852
2025-05-21 11:00:16 UTC-682db240.505-LOG:  connection authenticated: identity=\"CN=azuresu.d481e194acdf.database.azure.com\" method=cert (/datadrive/pg/data/pg_hba.conf:12)
2025-05-21 11:00:16 UTC-682db240.505-LOG:  connection authorized: user=azuresu database=azure_sys SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)
2025-05-21 11:00:16 UTC-682db240.505-LOG:  duration: 5.031 ms  parse <unnamed>: With slots_info AS (\r\n  SELECT \r\n    slot.slot_name,\r\n    slot.active,\r\n    slot.slot_type,\r\n    stat.write_lsn,\r\n    stat.flush_lsn,\r\n    stat.sync_state,\r\n    slot.restart_lsn,\r\n    CASE WHEN pg_is_in_recovery() THEN NULL ELSE pg_catalog.pg_wal_lsn_diff(pg_catalog.pg_current_wal_lsn(), slot.restart_lsn)::BIGINT END as wal_retention_from_restart_lsn,\r\n    stat.replay_lsn,\r\n    CASE WHEN stat.replay_lsn IS NULL THEN slot.restart_lsn ELSE stat.replay_lsn END as replay_lsn_else_restart_lsn,\r\n    CASE WHEN pg_is_in_recovery() THEN NULL ELSE pg_catalog.pg_walfile_name(CASE WHEN stat.replay_lsn IS NULL THEN slot.restart_lsn ELSE stat.replay_lsn END) END as must_retain_wal_file,\r\n    CASE WHEN pg_is_in_recovery() THEN NULL \r\n      ELSE (CASE WHEN stat.replay_lsn IS NULL THEN NULL ELSE pg_catalog.pg_wal_lsn_diff(pg_catalog.pg_current_wal_lsn(), slot.restart_lsn)::BIGINT END) \r\n    END as wal_retention_from_replay_lsn\r\n  FROM pg_catalog.pg_replication_slots slot \r\n  LEFT JOIN pg_catalog.pg_stat_replication stat ON slot.active_pid = stat.pid\r\n),\r\nstandby_and_walreplica_slot_info as (SELECT * FROM slots_info where slot_type = 'physical' and slot_name LIKE 'azure_standby%' or slot_name like 'wal_replica%' ),\r\nread_replica_slot_info as (SELECT * FROM slots_info where slot_type = 'physical' and slot_name not LIKE 'azure_standby%' and slot_name not like 'wal_replica%' )\r\nSELECT\r\n  (\r\n   SELECT row_to_json(t1) logical_slots FROM \r\n   ( SELECT \r\n     (SELECT count(*) as active FROM slots_info where slot_type = 'logical' and active = true),\r\n     (SELECT count(*) as inactive FROM slots_info where slot_type = 'logical' and active <> true),\r\n     (SELECT jsonb_agg(row_to_json(t)) \r\n       FROM ( SELECT * FROM slots_info where slot_type = 'logical'  order by replay_lsn_else_restart_lsn ) as t ) as lagging_order ) as t1),\r\n  (\r\n   SELECT row_to_json(t1) read_replica_slots FROM \r\n   ( SELECT \r\n       (SELECT count(*) as active FROM read_replica_slot_info where active = true),\r\n     (SELECT count(*) as inactive FROM read_replica_slot_info where active <> true),\r\n     (SELECT jsonb_agg(row_to_json(t)) \r\n       FROM ( SELECT * FROM read_replica_slot_info order by replay_lsn_else_restart_lsn limit 4 ) as t ) as lagging_order ) as t1),\r\n  (\r\n   SELECT row_to_json(t1) standby_and_walreplica_slots FROM \r\n   ( SELECT \r\n     (SELECT count(*) as active FROM standby_and_walreplica_slot_info where active = true),\r\n     (SELECT count(*) as inactive FROM standby_and_walreplica_slot_info where active <> true),\r\n     (SELECT jsonb_agg(row_to_json(t)) \r\n       FROM ( SELECT * FROM standby_and_walreplica_slot_info ) as t ) as lagging_order ) as t1),\r\n  (\r\n   Select row_to_json(t)::text as checkpoint_info \r\n    FROM (\r\n      Select\r\n        (SELECT  trunc(MAX(EXTRACT(EPOCH FROM CURRENT_TIMESTAMP - xact_start))) AS max_age FROM pg_stat_activity) oldest_live_tx_age,\r\n        trunc(EXTRACT(EPOCH FROM CURRENT_TIMESTAMP - checkpoint_time)) as seconds_after_last_checkpoint ,   \r\n        timeline_id,  \r\n        checkpoint_lsn, \r\n        TO_CHAR(checkpoint_time at time zone 'utc', 'YYYY-MM-DD HH24:MI:SS') as checkpoint_time,\r\n        CASE WHEN pg_is_in_recovery() THEN NULL ELSE pg_catalog.pg_walfile_name(checkpoint_lsn) END AS checkpoint_wal_file,\r\n        redo_lsn,  \r\n        redo_wal_file,  \r\n        buffers_alloc , \r\n        block_size,  \r\n        now()-stats_reset stats_reset \r\n      from pg_catalog.pg_control_checkpoint(), pg_stat_bgwriter,(SELECT cast(current_setting('block_size') AS integer) AS block_size) as sub_query) as t ),\r\n  (\r\n   Select  row_to_json(t)::text as archiver_info\r\n    FROM (\r\n      Select\r\n            trunc(EXTRACT(EPOCH FROM CURRENT_TIMESTAMP - last_archived_time)) last_archival, \r\n            (last_failed_wal IS NULL OR last_failed_wal <= last_archived_wal) is_archiving,  \r\n            trunc( CASE \r\n                    WHEN archived_count = 0 OR EXTRACT(EPOCH FROM age(now(), stats_reset)) = 0 THEN 0 \r\n                    ELSE CAST(archived_count AS NUMERIC)*60 / EXTRACT(EPOCH FROM age(now(), stats_reset)) \r\n                    END ) wals_archived_per_minute,  \r\n            last_archived_wal, \r\n            TO_CHAR(last_archived_time at time zone 'utc', 'YYYY-MM-DD HH24:MI:SS') as last_archived_time,\r\n            last_failed_wal, \r\n            archived_count,  \r\n            failed_count, \r\n            now()-stats_reset as stats_reset\r\n          from pg_catalog.pg_stat_archiver ) as t ),\r\n  (\r\n   Select row_to_json(t)::text as wal_upload_related_details \r\n        FROM (\r\n            SELECT\r\n              (SELECT CASE WHEN pg_is_in_recovery() THEN NULL ELSE pg_catalog.pg_walfile_name(pg_catalog.pg_current_wal_lsn()) END as current),\r\n              (SELECT CASE WHEN pg_is_in_recovery() THEN NULL ELSE pg_catalog.pg_walfile_name(flush_lsn) END as quorum_committed FROM slots_info where slot_type = 'physical' and sync_state='quorum' order by flush_lsn desc limit 1 ), \r\n              (SELECT CAST(pg_catalog.current_setting('azure.enforce_ha_quorom') AS BOOLEAN) AS enforce_ha_quorom),\r\n              (SELECT pg_catalog.current_setting('synchronous_standby_names') AS synchronous_standby_names),\r\n              (SELECT CAST(pg_catalog.pg_is_in_recovery() AS BOOLEAN) AS pg_is_in_recovery)\r\n    )  as t ),\r\n  (\r\n   select TO_CHAR(pg_catalog.now() at time zone 'utc', 'YYYY-MM-DD HH24:MI:SS')) as time_fetched
2025-05-21 11:00:30 UTC-682db23a.501-LOG:  disconnection: session time: 0:00:20.046 user=azuresu database=postgres host=127.0.0.1 port=34834
2025-05-21 11:00:30 UTC-682db24e.50a-LOG:  connection received: host=127.0.0.1 port=46378
2025-05-21 11:00:30 UTC-682db24e.50a-LOG:  connection authenticated: identity=\"CN=azuresu.d481e194acdf.database.azure.com\" method=cert (/datadrive/pg/data/pg_hba.conf:12)
2025-05-21 11:00:30 UTC-682db24e.50a-LOG:  connection authorized: user=azuresu database=postgres SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)
2025-05-21 11:00:33 UTC-682db23d.504-LOG:  disconnection: session time: 0:00:20.034 user=azuresu database=azure_maintenance host=127.0.0.1 port=34850
2025-05-21 11:00:36 UTC-682db254.50d-LOG:  connection received: host=127.0.0.1 port=46390
